# 朗読エクササイズ（ローカル版）

認知症予防のための古典文学朗読アプリケーション

## 概要

朗読エクササイズは、古典文学の朗読練習を通じて認知機能の維持・向上を支援するPWA（Progressive Web App）です。すべてのデータをブラウザ内（IndexedDB）に保存するため、**完全にプライベート**で**サーバー不要**で動作します。

### 主な機能

- **古典文学テキスト**: 好きなテキストをインポート・編集可能
- **音声録音**: ブラウザで直接録音が可能（32kbps、省容量）
- **録音管理**: 録音の保存、再生、削除（すべてブラウザ内）
- **進捗管理**: 録音済み作品数の可視化
- **カスタムテキスト**: オリジナルテキストの追加・編集
- **PWA対応**: スマートフォンにインストール可能
- **完全プライベート**: データはすべてブラウザ内、サーバーに送信されない
- **エクスポート/インポート**: JSONでデータをバックアップ・復元

## 技術スタック

### フロントエンド
- **Next.js 15.5.4** (App Router)
- **React 19.1.0**
- **TypeScript 5**
- **Tailwind CSS 3.4**

### ストレージ
- **IndexedDB** - テキストと音声データをブラウザ内に保存
- **idb** - IndexedDBラッパーライブラリ

### PWA
- **next-pwa 5.6.0**
- Service Worker対応

## セットアップ

### 前提条件

- Node.js 20以上
- npm または yarn
- モダンブラウザ（Chrome、Safari、Edge最新版）

### インストール
``` bash
# リポジトリのクローン
git clone https://github.com/damgoweb/recitation-app-local.git
cd recitation-app-local

# 依存関係のインストール
npm install
```

### 開発サーバーの起動
``` bash
npm run dev
```

http://localhost:3000 でアプリにアクセスできます。

### ビルド
``` bash
npm run build
npm start
```

## 使い方
### 初回セットアップ

#### 1. アプリを開く（初回は空の状態）
#### 2. サンプルデータのインポート：
- リポジトリには古典文学のサンプルデータが含まれています。
##### すべての作品をインポート
1. . [all-texts.json](https://github.com/damgoweb/recitation-app-local/raw/main/public/data/all-texts.json) をダウンロード
2. 「テキストをインポート」ボタンをクリック
##### 個別の作品をインポート
- `public/data/texts/` から必要な作品のみダウンロードしてインポートできます。
- [竹取物語](https://github.com/damgoweb/recitation-app-local/raw/main/public/data/texts/01-taketori.json)
- [平家物語](https://github.com/damgoweb/recitation-app-local/raw/main/public/data/texts/02-heike.json)
- ...

#### 3.または「新しいテキストを追加」で手動作成

### 録音の流れ
#### 1. テキストを選択
#### 2.「録音開始」ボタンをクリック
#### 3. 朗読する
#### 4. 「録音停止」→「保存する」
#### 5. 録音はブラウザ内（IndexedDB）に保存される

### データのバックアップ
- **重要**: ブラウザのキャッシュをクリアするとデータが消えます。定期的にバックアップしてください。

#### 1.「テキストをエクスポート」ボタンをクリック
#### 2.JSONファイルがダウンロードされる
#### 3.安全な場所に保存

### データの復元

#### 1.「テキストをインポート」ボタンをクリック
#### 2.バックアップしたJSONファイルを選択
#### 3.テキストが復元される（録音は含まれません）

## デプロイ
### Vercelへのデプロイ
``` bash
# Vercel CLIのインストール（初回のみ）
npm i -g vercel

# ログイン
vercel login

# デプロイ
vercel --prod
```
- または、GitHubにプッシュすることで自動デプロイ：
``` bash
git push origin main
```
- 環境変数は不要です。すべてのデータはブラウザ内に保存されます。

## プロジェクト構造

```
recitation-app-local/
├── app/
│   ├── texts/                # テキスト関連ページ
│   │   ├── [id]/             # テキスト詳細
│   │   ├── new/              # 新規作成
│   │   └── [id]/edit/        # 編集
│   ├── layout.tsx            # ルートレイアウト
│   ├── page.tsx              # ホーム（一覧）
│   └── globals.css           # グローバルCSS
├── src/
│   ├── components/           # Reactコンポーネント
│   │   ├── ui/               # 汎用UIコンポーネント
│   │   ├── AudioPlayer.tsx   # 音声プレーヤー
│   │   ├── RecordingControls.tsx  # 録音コントロール
│   │   ├── ImportButton.tsx  # インポート機能
│   │   ├── ExportButton.tsx  # エクスポート機能
│   │   └── TextDetailClient.tsx   # テキスト詳細
│   ├── hooks/                # カスタムフック
│   │   ├── useRecorder.ts    # 録音機能
│   │   ├── useRecording.ts   # 録音データ管理
│   │   └── useTexts.ts       # テキスト一覧管理
│   ├── lib/
│   │   ├── storage/          # IndexedDBストレージ層
│   │   │   ├── db.ts         # DB初期化
│   │   │   ├── texts.ts      # テキストCRUD
│   │   │   └── recordings.ts # 録音CRUD
│   │   └── utils.ts          # 汎用関数
│   └── types/                # TypeScript型定義
├── public/                   # 静的ファイル
│   ├── manifest.json         # PWAマニフェスト
│   └── icons/                # アプリアイコン
└── next.config.mjs           # Next.js設定
```

## トラブルシューティング
### 録音機能が動作しない
#### 症状: 「このブラウザは録音機能に対応していません」エラー
#### 原因と対処:
- HTTPでアクセスしている → HTTPSまたはlocalhostを使用
- マイク権限が拒否されている → ブラウザの設定で許可
- 非対応ブラウザ → Chrome、Safari、Edge最新版を使用

### データが消えた
#### 症状: テキストや録音がすべて消えている
#### 原因と対処:
- ブラウザのキャッシュをクリアした → バックアップから復元
- 別のブラウザで開いた → データは各ブラウザごとに独立
- プライベートモード → 通常モードで開き直す

### 録音が反映されない
#### 症状: 録音保存後、一覧画面で「未録音」のまま
#### 原因と対処:
- ページをリロード（F5）
- それでもダメならブラウザを再起動

### CSSが適用されない
#### 症状: スタイルが反映されず、テキストのみ表示
#### 原因と対処:
- ビルドキャッシュの問題 → .next フォルダを削除して再ビルド

### IndexedDBのデータを確認したい
#### デベロッパーツールで確認:

- F12 → Applicationタブ
- IndexedDB → recitation-db
- texts: テキストデータ
- recordings: 録音データ（Blob）

## パフォーマンス最適化
### 実装済みの最適化
- 動的インポート（Code Splitting）
- 画像最適化（AVIF/WebP対応）
- Service Workerによるオフライン対応
- 音声の低ビットレート（32kbps）で省容量
- IndexedDBによる高速データアクセス

### キャッシュ戦略
- **静的ファイル**: 1年間の長期キャッシュ
- **HTMLページ**: NetworkFirst（1日間）
- **音声データ**: IndexedDB内に保存（ブラウザ管理）

## セキュリティとプライバシー

### 実装済みの対策
- 完全オフライン: すべてのデータはブラウザ内、サーバーに送信されない
- HTTPS必須（録音機能）
- X-Frame-Options: DENY
- X-Content-Type-Options: nosniff
- マイク権限の適切な管理

### プライバシー保証
- 録音データはあなたのブラウザ内のみに保存
- サーバーやクラウドには一切送信されない
- 第三者がアクセス不可能
- 各ユーザーのデータは完全に独立

## 録音ファイルについて
### 仕様
- **形式**: WebM（Opus コーデック）
- **ビットレート**: 32kbps（朗読音声に最適化）
- **ファイルサイズ**: 約240KB/分
- **音質**: 人の声の聞き取りには十分

### ストレージ容量
- ブラウザの制限: 通常数GB〜数十GB
- 5分の録音 × 100件 = 約120MB
- 実用上、容量不足の心配は少ない

## ライセンス
- このプロジェクトは個人利用・教育目的での使用を想定しています。

## 開発者向けメモ

### 技術的特徴
- **クライアント完結**: サーバーレス、データベース不要
- **プライバシー重視**: データは一切外部送信されない
- **オフライン対応**: インターネット接続不要で動作
- **PWA**: ホーム画面に追加してネイティブアプリのように使用可能

### 既知の制限事項
- **ブラウザ依存**: データは各ブラウザごとに独立
- **デバイス間同期なし**: エクスポート/インポートで手動移行
- **キャッシュクリアリスク**: ブラウザデータ削除で消失
- **ストレージ容量**: ブラウザの制限に依存
- **録音はエクスポート不可**: テキストのみJSON出力可能

### データ移行
#### デバイス間でデータを移動する場合：
1. 旧デバイスでテキストをエクスポート
2. 録音は再度録音が必要（または録音なしで使用）
3. 新デバイスでインポート

### 今後の改善案
- 録音データを含むフルバックアップ（ZIPファイル）
- クラウドストレージ連携（Google Drive等）
- 複数録音の比較機能
- ダークモード対応
- 録音の品質設定（ビットレート選択）

